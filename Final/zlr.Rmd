---
title: 'Final Exam'
subtitle: "STAT 353"
author: "" #change to your name
date: '3/15/2023'
output: 
  html_document:
    toc: true
    toc_float: true
    toc_depth: 2
editor_options: 
  markdown: 
    wrap: 72
urlcolor: blue
linkcolor: red
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(readr)
library(pscl)
library(car)
#read in the data
data <- read_csv("SSOCS(2017-2018)Data.csv")
#names(data)[181:200]
```

# An Overview of the Problem

In the United States, gun violence in K-12 schools has grown rapidly over the past two decades. For example, the mass shooting at Uvalde Elementary in Texas (2022) received a large degree of media attention. While the scale of this event was extreme, however, gun violence of smaller scales is more [common](https://news.google.com/search?q=gun%20school&hl=en-US&gl=US&ceid=US%3Aen) .

As gun violence increases, researchers and policymakers continue to search for solutions. These include ideas like increasing monitoring of social and mental health of students, using metal detectors, stationing police in schools, among others. This question - What can we do to reduce gun violence? - provides the background for this exam.

## The SSOCS Data

"The School Survey on Crime and Safety (SSOCS) — a nationally representative survey of U.S. K–12 public schools — is managed by the National Center for Education Statistics (NCES), an agency within the U.S. Department of Education’s Institute of Education Sciences. SSOCS collects detailed information from public schools on the incidence, frequency, seriousness, and nature of violence affecting students and school personnel. SSOCS also collects information on the programs, practices, and policies that schools have in place to prevent and reduce crime. Data from this collection can be used to examine the relationship between school characteristics and violent crimes in regular public primary, middle, high, and combined schools."

All of the information that you need to understand this data is provided. This includes:

 * `SSOCS(2017-2018)Data.csv` : The data
 * `ssocs codebook.pdf` : The code book

Notice that in the code book, the `Appendix A` includes the actual survey and that `Appendix B` includes a list of all the variable names and definitions. Further information on the creation of composite variables (those ending in "18") can be found in `Chapter 5`.

(Throughout, pay particular attention to data with values of "-1". These are purposeful skips and in many (but not all) cases may need to be re-coded to "0".)

## This Exam 

The purpose of this exam is to test your ability to put to use all that you have learned in STAT 353 in the context of real data, with a real question. This involves combining your understanding of regression concepts and theory with the implementation of these in code and clear interpretation to a lay audience. Be sure to convey what the results tell you, what assumptions they require, and any limitations in your results. 

For this exam, we will focus in particular on two outcomes:

  - `INCID18` : total incidents of any crime
  - `DISFIRE18` : total use of firearm or explosive

To simply the analysis, you can ignore the sampling weights / jackknife replicates.
  
**Finally, a strong exam is one that is judicious in what is presented (you can put materials in an Appendix), that explains the decisions and assumptions that were made and why, that explains the how the results should be interpreted, and that is clear in any limitations.**


# Part I. Testing Hypotheses

As stated above, researchers and policymakers have hypothesized and enacted a variety of policies meant to reduce crimes and gun violence in schools. In particular, they often argue that schools should include *security guards* in order to reduce crime and gun violence.

For this part, answer the following questions:

1. After exploring the two outcomes (`INCID18` and `DISFIRE18`) determine what type of regression model is appropriate for each (e.g., OLS). Explain which is best and why.
```{r hypothesis1}
ssocs <- read.csv("SSOCS(2017-2018)Data.csv")
# total_incidents <- ssocs$INCID18
# total_use <- ssocs$DISFIRE18
summary(ssocs$INCID18)
summary(ssocs$DISFIRE18)
```
By the summary above and code book(Table D-1), `DISFIRE18` is the total number of disciplinary actions recorded for use or possession of a firearm or explosive device, with range from -1.0000 to 81.0000. If C0458>0, i.e. total number of students involved in use/possession firearm/explosive device are less than 0, then `DISFIRE18` = C0460+C0462+C0464+C0466; else if C0458<0, then `DISFIRE18` = -1.
```{r}
# change all -1 in DISFIRE18 to 0 since they are same idea.
ssocs$DISFIRE18 <- ifelse(ssocs$DISFIRE18 == -1, 0, ssocs$DISFIRE18)
```

```{r}
# check distribution
plot(density(ssocs$INCID18))
plot(density(ssocs$DISFIRE18))
```
      
According to their density plots, we find that both of them are not normally distributed. So, OLS is not appropriate. Also, since both of the two outcomes (`INCID18` and `DISFIRE18`) are not binary and discrete, then I think the Poisson Regression Model is the most appropriate.   

2. Are the presence of *security guards* (`SEC_FT18` and `SEC_PT18`)  associated with reductions in crime (`INCID18`) and gun violence (`DISFIRE18`)? Interpret the effects clearly in language that a non-statistician could understand. 

```{r hypothesis2}
model_Q2.1 <- glm(INCID18 ~ SEC_FT18 + SEC_PT18, family = poisson, data = ssocs)
model_Q2.2 <- glm(DISFIRE18 ~ SEC_FT18 + SEC_PT18, family = poisson, data = ssocs)
summary(model_Q2.1)
summary(model_Q2.2)
```
The presence of *security guards* are negatively associated with reductions in crime. 


3. To what extent do these effects differ in urban schools versus non-urban schools?

```{r hypothesis3}
urban <- ssocs[ssocs$FR_URBAN == 1,]
non_urban <- ssocs[ssocs$FR_URBAN != 1,]

model_urban1 <- glm(INCID18 ~ SEC_FT18 + SEC_PT18, family = poisson, data = urban)
model_urban2 <- glm(DISFIRE18 ~ SEC_FT18 + SEC_PT18, family = poisson, data = urban)
summary(model_urban1)
summary(model_urban2)
```
```{r}
model_non_urban1 <- glm(INCID18 ~ SEC_FT18 + SEC_PT18, family = poisson, data = non_urban)
model_non_urban2 <- glm(DISFIRE18 ~ SEC_FT18 + SEC_PT18, family = poisson, data = non_urban)
summary(model_non_urban1)
summary(model_non_urban2)
```

```{r}
compareCoefs(model_urban1, model_urban2)
compareCoefs(model_non_urban1, model_non_urban2)
```


4.  Do your analyses suggest that policymakers are correct that security guards reduce crime and gun violence? If so, explain why. If not, conduct additional analyses (using regression) that allow you to evaluate their claim and interpret your results. 

```{r hypothesis4}

```


# Part II. Predicting Crime

Other researchers and policymakers would like to develop a model to predict crime (`INCID18`) based upon observable school characteristics. Their idea is that they could first predict schools that have a lot of crime and then put in place interventions that could reduce such crime. 

For this part, perform the following tasks. 

1. For your first model, use variables `C0532`, `C0534`, `C0536`, `C0538`, `C0560`, `C0562`, `C0568`, `FR_LVEL`, `FR_URBAN`, and `FR_SIZE` as predictor variables. Be sure to pay attention to non-linearities and interactions. (In addition to Appendix B, you can find more detailed explanation for the variables `C0532` to `C0568` on pages 80-81 of the code book, and the three variables `FR_LVEL`, `FR_URBAN`, and `FR_SIZE` on page 172). How well does this model perform? 


```{r predict1}
model_pre <- glm(INCID18 ~ C0532 + C0534 + C0536 + C0538 + C0560
                    + C0562 + C0568 + FR_LVEL + FR_URBAN + FR_SIZE, family = poisson, data = ssocs)

summary(model_pre)
```

2. Create a new model that includes only those covariates that were statistically significant in (1), further refining this until all covariates in this model are statistically significant. How well does this model perfrom relative to Model (1)? 


```{r predict2}
model_new <- glm(INCID18 ~ C0532 + C0534 + C0536 + C0538 + C0560
                    + C0562 + FR_LVEL + FR_URBAN + FR_SIZE, family = poisson, data = ssocs)

summary(model_new)
```



3.  Develop and implement an approach to build the best model possible that predicts the total number of crimes (incidents, `INCID18`). (In addition to the variables mentioned in the previous problem, you may consider other variables, but be sure to explain your thinking.) 

    What is your final model and why do you think it is the best?  Be sure to clearly explain your approach in language a non-statistician could understand.


```{r predict3}

```

4. Does your final model do a good job in predicting crime? Explain to a policymaker if and how they should properly use this model. 


